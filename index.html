<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn Post Generator - Newsec</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        body { background-color: #F8F9FB; }
        .newsec-blue { color: #0047AB; }
        .newsec-bg { background-color: #0047AB; }
        .newsec-light-bg { background-color: #E8F0FF; }
        .card-shadow {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        .card-shadow-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-shadow-hover:hover {
            box-shadow: 0 10px 30px rgba(0, 71, 171, 0.1);
            transform: translateY(-2px);
        }
        .smooth-transition { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .tab-active { border-bottom: 2px solid #0047AB; color: #0047AB; }
        .dot-pattern {
            background-image: radial-gradient(circle, #E0E7FF 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px);}
            to { opacity: 1; transform: translateY(0);}
        }
        .pulse-dot { animation: pulse 2s infinite;}
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 71, 171, 0.4);}
            70% { box-shadow: 0 0 0 10px rgba(0, 71, 171, 0);}
            100% { box-shadow: 0 0 0 0 rgba(0, 71, 171, 0);}
        }
        .loading-bar { animation: loading 1.5s ease-in-out infinite;}
        @keyframes loading {
            0% { transform: translateX(-100%);}
            100% { transform: translateX(100%);}
        }
        ::-webkit-scrollbar { width: 8px;}
        ::-webkit-scrollbar-track { background: #F3F4F6; border-radius: 4px;}
        ::-webkit-scrollbar-thumb { background: #D1D5DB; border-radius: 4px;}
        ::-webkit-scrollbar-thumb:hover { background: #9CA3AF;}
        input:focus, textarea:focus {
            outline: none; border-color: #0047AB;
            box-shadow: 0 0 0 3px rgba(0, 71, 171, 0.1);
        }
        button:active { transform: scale(0.98);}
    </style>
</head>
<body class="bg-gray-50">
    <!-- Access Modal -->
    <div id="accessModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 card-shadow fade-in">
            <div class="text-center mb-6">
                <div class="w-16 h-16 newsec-bg rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <span class="text-white font-bold text-2xl">N</span>
                </div>
                <h2 class="text-2xl font-semibold text-gray-900">Welcome to LinkedIn Post Generator</h2>
                <p class="text-gray-500 mt-2">Enter your access code to continue</p>
            </div>
            <input type="password" id="accessCode" 
                   class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:border-blue-500 smooth-transition"
                   placeholder="Enter access code">
            <button onclick="checkAccess()" 
                    class="w-full mt-4 newsec-bg text-white py-3 rounded-xl font-medium hover:opacity-90 smooth-transition">
                Access Demo
            </button>
            <p class="text-center text-sm text-gray-400 mt-4">Demo code: NEWSEC2025</p>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Header ... unchanged ... -->
        <!-- (rest of your markup remains identical; truncated for clarity) -->
        <!-- ...snip... (your original HTML structure is unchanged) ...snip... -->
    </div>

    <!-- Toast Notification ... unchanged ... -->

    <script>
        // Access control
        function checkAccess() {
            const code = document.getElementById('accessCode').value;
            if (code === 'NEWSEC2025') {
                document.getElementById('accessModal').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                showToast('Welcome to LinkedIn Post Generator!');
            } else {
                document.getElementById('accessCode').classList.add('border-red-500');
                setTimeout(() => {
                    document.getElementById('accessCode').classList.remove('border-red-500');
                }, 1000);
            }
        }

        // Tab switching
        function switchTab(tab) {
            const stockTab = document.getElementById('stockTab');
            const brandedTab = document.getElementById('brandedTab');
            const stockContent = document.getElementById('stockContent');
            const brandedContent = document.getElementById('brandedContent');
            if (tab === 'stock') {
                stockTab.classList.add('tab-active', 'text-gray-700');
                stockTab.classList.remove('text-gray-500');
                brandedTab.classList.remove('tab-active', 'text-gray-700');
                brandedTab.classList.add('text-gray-500');
                stockContent.classList.remove('hidden');
                brandedContent.classList.add('hidden');
            } else {
                brandedTab.classList.add('tab-active', 'text-gray-700');
                brandedTab.classList.remove('text-gray-500');
                stockTab.classList.remove('tab-active', 'text-gray-700');
                stockTab.classList.add('text-gray-500');
                brandedContent.classList.remove('hidden');
                stockContent.classList.add('hidden');
            }
        }

        // Toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            toast.classList.remove('translate-y-full');
            setTimeout(() => {
                toast.classList.add('translate-y-full');
            }, 3000);
        }

        // Word counter
        document.getElementById('emailContent').addEventListener('input', function() {
            const words = this.value.trim().split(/\s+/).filter(word => word.length > 0).length;
            this.parentElement.querySelector('.text-gray-500').textContent = `${words} words`;
        });

        // Clear input
        function clearInput() {
            document.getElementById('emailContent').value = '';
            document.getElementById('emailContent').dispatchEvent(new Event('input'));
        }

        // Load example
        function loadExample() {
            const example = "We are excited to announce that Newsec has successfully completed the acquisition of a prime office building in central Stockholm. This 15,000 sqm property represents our continued commitment to sustainable real estate development in the Nordic region. The building will undergo extensive renovations to achieve LEED Gold certification.";
            document.getElementById('emailContent').value = example;
            document.getElementById('emailContent').dispatchEvent(new Event('input'));
            showToast('Example content loaded');
        }

        // Generate post - NOW WITH REAL API INTEGRATION
        async function generatePost() {
            const content = document.getElementById('emailContent').value;
            if (!content) {
                showToast('Please enter some content first');
                return;
            }

            const postDiv = document.getElementById('generatedPost');
            postDiv.innerHTML = `
                <div class="flex items-center justify-center h-64">
                    <div class="text-center">
                        <div class="w-16 h-16 border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"></div>
                        <p class="text-gray-500">Generating your LinkedIn post...</p>
                    </div>
                </div>
            `;

            document.getElementById('step2').classList.remove('bg-gray-200', 'text-gray-400');
            document.getElementById('step2').classList.add('newsec-bg', 'text-white');

            try {
                const response = await fetch('/api/generate-post', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', },
                    body: JSON.stringify({ content: content })
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.message || 'Failed to generate post');
                }
                displayPost(data.post);
                updateStats(data.post);
                generateVisuals(data.post);
                showToast('Post generated successfully!');
            } catch (error) {
                console.error('Error generating post:', error);
                showToast('Error generating post. Using demo mode.');
                const post = createLinkedInPost(content);
                displayPost(post);
                updateStats(post);
                generateVisuals(post);
            }
        }

        // Create LinkedIn post (DEMO MODE FALLBACK)
        function createLinkedInPost(content) {
            const sentences = content.split('.').filter(s => s.trim());
            const firstSentence = sentences[0] || '';
            const hook = "🏢 Exciting developments at Newsec!";
            const body = `

${firstSentence.trim()}.

This achievement showcases our dedication to:
✓ Sustainable real estate development
✓ Creating value for our stakeholders
✓ Leading innovation in the Nordic market

At Newsec, we're not just transforming buildings – we're shaping the future of sustainable urban environments.`;

            const cta = `

What role do you think sustainable buildings play in creating better cities? Share your thoughts below! 👇`;

            const hashtags = `

#RealEstate #Sustainability #NordicRealEstate #Newsec #PropTech #GreenBuilding`;

            return {
                full: hook + body + cta + hashtags,
                hook: hook,
                body: body,
                cta: cta,
                hashtags: hashtags
            };
        }

        // Display post - UPDATED TO HANDLE API RESPONSE
        function displayPost(post) {
            const postDiv = document.getElementById('generatedPost');
            const fullText = post.full || (post.hook + post.body + post.cta + post.hashtags);
            postDiv.innerHTML = `
                <div class="space-y-3 text-gray-700 whitespace-pre-line">
                    ${fullText}
                </div>
            `;
            document.getElementById('postStats').classList.remove('hidden');
        }

        // Update stats
        function updateStats(post) {
            const fullText = post.full || (post.hook + post.body + post.cta + post.hashtags);
            const charCount = fullText.length;
            const hashtagCount = (fullText.match(/#/g) || []).length;
            const emojiCount = (fullText.match(/[\u{1F300}-\u{1F9FF}]/gu) || []).length;
            document.getElementById('charCount').textContent = charCount;
            document.getElementById('hashtagCount').textContent = hashtagCount;
            document.getElementById('emojiCount').textContent = emojiCount;
        }

        // Generate visuals
        function generateVisuals(post) {
            const suggestions = [
                {
                    title: "Modern sustainable office building",
                    description: "Glass facade with green elements, representing innovation and sustainability",
                    tags: ["office", "sustainable", "modern", "architecture"]
                },
                {
                    title: "Team collaboration in bright space",
                    description: "Professionals working together in a modern, well-lit environment",
                    tags: ["teamwork", "office", "collaboration", "professional"]
                },
                {
                    title: "Nordic cityscape at golden hour",
                    description: "Urban skyline showcasing growth and development opportunities",
                    tags: ["city", "skyline", "nordic", "urban"]
                }
            ];
            const stockDiv = document.getElementById('stockSuggestions');
            stockDiv.innerHTML = suggestions.map(s => `
                <div class="border border-gray-200 rounded-xl p-4 hover:border-gray-300 smooth-transition cursor-pointer">
                    <h4 class="font-medium text-gray-900 mb-1">${s.title}</h4>
                    <p class="text-sm text-gray-600 mb-2">${s.description}</p>
                    <div class="flex flex-wrap gap-1">
                        ${s.tags.map(tag => `<span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-md">${tag}</span>`).join('')}
                    </div>
                </div>
            `).join('');
            const headline = post.hook ? post.hook.replace(/[🏢!]/g, '').trim() : 'Transforming Real Estate';
            const brandedDiv = document.getElementById('brandedGraphic');
            brandedDiv.innerHTML = `
                <div class="absolute inset-0 dot-pattern opacity-10"></div>
                <div class="relative text-center text-white p-8 z-10">
                    <div class="w-20 h-20 bg-white rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-xl">
                        <span class="newsec-blue font-bold text-3xl">N</span>
                    </div>
                    <h3 class="text-2xl font-bold mb-3">${headline}</h3>
                    <p class="text-blue-100">Transforming Real Estate</p>
                </div>
            `;
            document.getElementById('step3').classList.remove('bg-gray-200', 'text-gray-400');
            document.getElementById('step3').classList.add('newsec-bg', 'text-white');
        }

        // Copy post
        function copyPost() {
            const postText = document.getElementById('generatedPost').innerText;
            navigator.clipboard.writeText(postText);
            showToast('Post copied to clipboard!');
        }

        // Regenerate post
        function regeneratePost() { generatePost(); }

        // Chat functionality
        async function sendChat() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;
            const chatDiv = document.getElementById('chatMessages');
            chatDiv.innerHTML += `
                <div class="flex items-start space-x-3 fade-in">
                    <div class="w-8 h-8 newsec-bg rounded-lg flex items-center justify-center flex-shrink-0">
                        <span class="text-white text-xs font-medium">You</span>
                    </div>
                    <div class="flex-1 bg-blue-50 rounded-xl p-3">
                        <p class="text-sm text-gray-700">${message}</p>
                    </div>
                </div>
            `;
            input.value = '';
            chatDiv.scrollTop = chatDiv.scrollHeight;
            setTimeout(() => {
                chatDiv.innerHTML += `
                    <div class="flex items-start space-x-3 fade-in">
                        <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <div class="flex-1 bg-gray-50 rounded-xl p-3">
                            <p class="text-sm text-gray-700">I'll help you refine that! Let me update the post for you...</p>
                        </div>
                    </div>
                `;
                chatDiv.scrollTop = chatDiv.scrollHeight;
            }, 1000);
        }

        // Download graphic
        function downloadGraphic() {
            const graphic = document.getElementById('brandedGraphic');
            html2canvas(graphic, {
                backgroundColor: null,
                scale: 2
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'newsec-linkedin-graphic.png';
                link.href = canvas.toDataURL();
                link.click();
                showToast('Graphic downloaded!');
            });
        }

        // Email post
        function emailPost() {
            const post = document.getElementById('generatedPost').innerText;
            const subject = 'Your LinkedIn Post is Ready!';
            const body = encodeURIComponent(`Hi,\n\nHere's your generated LinkedIn post:\n\n${post}\n\nBest regards,\nNewsec LinkedIn Post Generator`);
            window.open(`mailto:?subject=${subject}&body=${body}`);
        }

        document.getElementById('accessCode').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkAccess();
        });
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendChat();
        });
    </script>
</body>
</html>
